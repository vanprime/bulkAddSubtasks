## Function Descriptions

This section details the core logic functions found within the `/src/functions` directory.

*   **[`createJiraApiBaseUrl.js`](./createJiraApiBaseUrl.js):**
    *   Constructs the base URL for the Jira REST API (e.g., `https://your-jira.com/rest/api/latest`) based on the current browser window's location (`window.location.protocol` and `window.location.host`). Returns the API base URL string or `undefined` if `window.location` is not available.
*   **[`getProjectVariables.js`](./getProjectVariables.js):**
    *   Parses the current page URL (`window.location`) to determine the context for sub-task creation.
    *   Extracts the `parentIssue` key (e.g., "PROJ-123") either from the `selectedIssue` query parameter (on Backlog view `/secure/RapidBoard.jspa`) or from the last path segment (on Single Issue view `/browse/*` or `/projects/*`).
    *   Derives the `projectKey` (e.g., "PROJ") from the `parentIssue` key.
    *   Returns an object `{ parentIssue, projectKey }`.
    *   Throws an `Error` object with a descriptive `message` property if the URL doesn't match expected patterns or if keys cannot be determined.
*   **[`getCreateIssueMetadata.js`](./getCreateIssueMetadata.js):**
    *   Fetches metadata required for creating sub-tasks within a specific project.
    *   Makes an asynchronous `GET` request to the Jira REST API endpoint: `/issue/createmeta/{projectKey}/issuetypes/{subTaskId}`.
    *   Uses the `projectKey` obtained from [`getProjectVariables.js`](./getProjectVariables.js) and a hardcoded `subTaskId` (from [`../constants.js`](../constants.js)).
    *   Includes user credentials (cookies) in the request.
    *   Returns the parsed JSON response containing field definitions upon success.
    *   Throws an `Error` object with a descriptive `message` property (including HTTP status and body if available) on HTTP errors or network issues.
*   **[`getCurrentUserInformation.js`](./getCurrentUserInformation.js):**
    *   Fetches details about the currently logged-in Jira user.
    *   Makes an asynchronous `GET` request to the Jira REST API endpoint: `/myself`.
    *   Includes user credentials (cookies) in the request.
    *   Returns the parsed JSON response containing user details (specifically used to get the `name` for the reporter field) upon success.
    *   Throws an `Error` object with a descriptive `message` property (including HTTP status and body if available) on HTTP errors or network issues.
*   **[`constructIssueData.js`](./constructIssueData.js):**
    *   Takes the parsed sub-task summaries (`tasks`), project/issue context (`projectKey`, `parentIssueKey`), user info (`reporter`), and metadata (`metadata`) as input.
    *   Iterates through each `task` summary.
    *   For each task, creates a base issue payload containing `summary`, `issuetype` (using hardcoded `subTaskId` from [`../constants.js`](../constants.js)), `project`, `parent`, and `reporter`.
    *   Identifies required fields from the `metadata`.
    *   For any required field *not* already in the base payload, it attempts to populate it using the first `allowedValues` entry from the metadata.
    *   Returns an array (`issueDataArray`) where each element is a fully constructed issue payload object, ready for the bulk API.
    *   Throws an `Error` if a required field cannot be auto-populated (e.g., no `allowedValues` available), with a message indicating the problematic `fieldId`.
*   **[`postJiraIssues.js`](./postJiraIssues.js):**
    *   Sends the bulk sub-task creation request to Jira.
    *   Takes the array of issue payloads (`issueData`) generated by [`constructIssueData.js`](./constructIssueData.js) as input.
    *   Makes an asynchronous `POST` request to the Jira REST API endpoint: `/issue/bulk`.
    *   Formats the input array into the required `{ "issueUpdates": [...] }` structure for the request body.
    *   Includes user credentials (cookies) in the request.
    *   Returns the parsed JSON response from the Jira API upon success.
    *   Throws an `Error` object with a descriptive `message` property (including HTTP status and body if available) on HTTP errors or network issues.

---

### Suggestions for Improvement:

1.  **Parameter/Return Types:** Explicitly document the expected parameter types and the structure/type of the return value for each function (e.g., using JSDoc-like notation like `@param {string} projectKey` or `@returns {Promise<object>}`). This improves clarity, especially for asynchronous functions returning Promises.
2.  **Error Handling Details:** While errors are mentioned, specify *what kind* of object is thrown (e.g., `Error` object) and the structure of the error (e.g., always contains a `.message` property).
3.  **Dependency Clarity:** Explicitly list dependencies for each function, not just internal ones (like `createJiraApiBaseUrl`) but also external ones like `window.location` or the hardcoded `subTaskId` from `constants.js`.
4.  **Add Overview:** Consider adding a short introductory paragraph summarizing the overall purpose of these functions (e.g., "These functions handle the core logic for interacting with the Jira API and processing user input for bulk sub-task creation.").
5.  **Constants Link:** Ensure the link to `constants.js` is correct relative to this file (it should be `../constants.js`). *Self-correction: Updated links above.*
6.  **Metadata Structure:** Briefly mention the expected structure of the `metadata` object used in `constructIssueData.js` (e.g., "expects metadata object containing a `values` array, where each element represents a field and may have `required` and `allowedValues` properties").